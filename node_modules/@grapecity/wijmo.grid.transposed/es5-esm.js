/*!
    *
    * Wijmo Library 5.20203.748
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();import{assert,isArray,isString,isNumber,isUndefined,asBoolean,getTypes,getType,tryCast,toHeaderCase,addClass,DataType,Binding,Control,CollectionView,ObservableArray,NotifyCollectionChangedEventArgs,NotifyCollectionChangedAction,_registerModule}from"@grapecity/wijmo";import{FlexGrid,Row,Column,ColumnCollection,AllowSorting,HeadersVisibility}from"@grapecity/wijmo.grid";import*as selfModule from"@grapecity/wijmo.grid.transposed";var TransposedGrid=function(e){__extends(TransposedGrid,e);function TransposedGrid(t,o){var r=e.call(this,t,null)||this;r._keyPrefix="item";r._autoGenRows=!0;addClass(r.hostElement,"wj-transposed-grid");r.allowSorting=AllowSorting.None;r.headersVisibility=HeadersVisibility.Row;r._rowInfo=new ColumnCollection(r,r.columns.defaultSize);r.initialize(o);r._rowInfo.collectionChanged.addHandler(r._rowInfoChanged,r);r.deferUpdate((function(){var e=r.rowHeaders.columns;if(e.length){e[e.length-1].width=r.columns.defaultSize}}));return r}Object.defineProperty(TransposedGrid.prototype,"autoGenerateRows",{get:function(){return this._autoGenRows},set:function(e){this._autoGenRows=asBoolean(e)},enumerable:!0,configurable:!0});TransposedGrid.prototype.refresh=function(t){var o=this._rowInfo;if(o._dirty){o._dirty=!1;this._rowInfoChanged()}else e.prototype.refresh.call(this,t)};Object.defineProperty(TransposedGrid.prototype,"allowAddNew",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0});Object.defineProperty(TransposedGrid.prototype,"allowDelete",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0});Object.defineProperty(TransposedGrid.prototype,"allowSorting",{get:function(){return AllowSorting.None},set:function(e){assert(e===AllowSorting.None,"TransposedGrid does not support sorting.");this._alSorting=e},enumerable:!0,configurable:!0});TransposedGrid.prototype.onRowEditEnded=function(t){var o=tryCast(this._sourceItems,"ICollectionView");if(o){var r=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change);o.collectionChanged.raise(o,r)}e.prototype.onRowEditEnded.call(this,t)};TransposedGrid.prototype._getCollectionView=function(t){var o=this,r=tryCast(this._sourceItems,"ICollectionView");r&&r.collectionChanged.removeHandler(this._sourceViewChanged);r=tryCast(t,"ICollectionView");var n=t;if(isArray(t))n=this._transposeItemsSource(t);else if(r){r.collectionChanged.addHandler(this._sourceViewChanged,this);n=this._transposeItemsSource(r.items)}this.autoGenerateColumns=!0;var i=e.prototype._getCollectionView.call(this,n),s=null;r instanceof CollectionView&&(s=r.getError);s&&i instanceof CollectionView&&(this._supportsProxies()?i.getError=function(e,t){var o=e._keys.indexOf(t);return s(e._arr[o],e._bnd.path)}:i.getError=function(e,t){var r=parseInt(t.substr(o._keyPrefix.length));return s(e._arr[r],e._rowInfo.binding)});this._sourceItems=t;return i};TransposedGrid.prototype._getColumnTypes=function(e){var t,o=this;if(this._sourceItems)if(isArray(this._sourceItems))t=this._sourceItems;else{var r=tryCast(this._sourceItems,"ICollectionView");r&&(t=r.items)}return t?t.map((function(e,t){return{binding:o._keyPrefix+t,dataType:DataType.Object}})):getTypes(e)};TransposedGrid.prototype._copy=function(t,o){var r=this;if(/rows|columns/.test(t)){assert(isArray(o),"Array Expected.");this._rowInfo.deferUpdate((function(){r.autoGenerateRows=!1;r._rowInfo.clear();o.forEach((function(e){var t=new Column(e);r._rowInfo.push(t)}))}));return!0}return e.prototype._copy.call(this,t,o)};TransposedGrid.prototype.onLoadedRows=function(t){for(var o=this,r=this.rowHeaders.columns,n=0;n<r.length;n++)r[n].align="left";var i=this.columns;for(n=0;n<i.length;n++){var s=i[n];s.align=null;s.dataType=0}var a=FlexGrid._getSerializableProperties(Row);this.rows.forEach((function(e){var t=e.dataItem._rowInfo;if(t){o._copyProps(t,e,a,"showDropDown");if(r.length){var n=t.header||toHeaderCase(t.binding);o.rowHeaders.setCellData(e.index,r.length-1,n)}}}));e.prototype.onLoadedRows.call(this,t)};TransposedGrid.prototype._getBindingColumn=function(e,t,o){var r=o;if(e!=this.cells)return r;var n=e.rows[t].dataItem._rowInfo;if(isUndefined(n))return r;r=new Column;var i=FlexGrid._getSerializableProperties(Column);this._copyProps(n,r,i);r.binding=o.binding;r.header=n.header||toHeaderCase(n.binding);return r};TransposedGrid.prototype._copyProps=function(e,t,o,r){void 0===r&&(r="");for(var n in e)if(o.indexOf(n)>-1&&n!=r){var i=e[n];if(!isUndefined(i))try{t[n]=i}catch(e){}}};TransposedGrid.prototype._rowInfoChanged=function(){var e=this;this._toRowInfo&&clearTimeout(this._toRowInfo);this._toRowInfo=setTimeout((function(){var t=e.selection,o=e.itemsSource;e.itemsSource=null;e.itemsSource=o;e.selection=t}),Control._REFRESH_INTERVAL)};TransposedGrid.prototype._sourceViewChanged=function(e,t){this.activeEditor||this.invalidate()};TransposedGrid.prototype._transposeItemsSource=function(e){var t=this,o=new ObservableArray,r=getTypes(e),n=e.map((function(e,o){return t._keyPrefix+o}));(this.autoGenerateRows?this._getRowInfo(e):this._rowInfo).forEach((function(i,s){var a=new Binding(i.binding);if(null==i.dataType){var d=a.getValue(e[0]);i.dataType=null!=d?getType(d):r[s].dataType}if(t._supportsProxies()){var l=t._createProxy(e,i,n);o.push(l)}else{var c=t._createTransposedObject(e,i,t._keyPrefix);o.push(c)}}));e instanceof ObservableArray&&e.collectionChanged.addHandler((function(e,r){if(r.action===NotifyCollectionChangedAction.Change)t.activeEditor||t.invalidate();else{var n=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset);o.onCollectionChanged(n);t._rowInfoChanged()}}));return o};TransposedGrid.prototype._supportsProxies=function(){return null!=window.Proxy};TransposedGrid.prototype._createProxy=function(e,t,o){var r={_arr:e,_rowInfo:t,_bnd:new Binding(t.binding),_keys:o};return new Proxy(r,{ownKeys:function(e){return e._keys},getOwnPropertyDescriptor:function(){return{enumerable:!0,configurable:!0,writable:!0}},get:function(e,t){var o=e._keys.indexOf(t);return o>-1?e._bnd.getValue(e._arr[o]):e[t]},set:function(e,t,o){var r=e._keys.indexOf(t);if(r>-1){var n=e._arr,i=n[r];e._bnd.setValue(i,o);if(n instanceof ObservableArray){var s=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change,i,r);n.onCollectionChanged(s)}return!0}return!1}})};TransposedGrid.prototype._createTransposedObject=function(e,t,o){for(var r={_arr:e,_rowInfo:t},n=new Binding(t.binding),_loop_1=function(t){var i=e[t];Object.defineProperty(r,o+t,{enumerable:!0,get:function(){return n.getValue(i)},set:function(o){n.setValue(i,o);if(e instanceof ObservableArray){var r=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change,i,t);e.onCollectionChanged(r)}return!0}})},i=0;i<e.length;i++)_loop_1(i);return r};TransposedGrid.prototype._getRowInfo=function(e){var t=this,o=[];getTypes(e).forEach((function(e){var r=e.binding,n=e.dataType;if(n!=DataType.Object&&n!=DataType.Array){var i={binding:r,header:toHeaderCase(r),dataType:n},s=FlexGrid._defTypeWidth[n];if(null!=s){if(isString(s)){var a=Math.round(parseFloat(s));s=s.indexOf("*")<0?a:a*t.columns.defaultSize}isNumber(s)&&s>0&&(i.width=s)}o.push(i)}}));return o};return TransposedGrid}(FlexGrid);export{TransposedGrid};var TransposedGridRow=function(e){__extends(TransposedGridRow,e);function TransposedGridRow(){return null!==e&&e.apply(this,arguments)||this}return TransposedGridRow}(Column);export{TransposedGridRow};_registerModule("wijmo.grid.transposed",selfModule);